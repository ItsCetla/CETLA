<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CETLA Racing League</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles.css?v=2025-12-18-18">
  <link rel="stylesheet" href="assets/analytics.css?v=2025-12-18-3">
</head>
<body>
  <!-- Mobile App Shell (shown on small screens) -->
  <div id="m-app" class="m-app" aria-label="CETLA mobile app">
    <header class="m-topbar">
      <button class="m-topbar__brand" type="button" data-m-view="home" aria-label="Go to home">CETLA</button>
      <label class="m-topbar__season">
        <span class="sr-only">Season</span>
        <select id="m-season-select" aria-label="Select season"></select>
      </label>
    </header>

    <main class="m-views" aria-live="polite">
      <section id="m-view-home" class="m-view is-active" data-view="home">
        <div class="m-hero" id="m-hero">
          <p class="m-muted">Loading…</p>
        </div>
        <div class="m-quick-actions">
          <button class="m-action" type="button" data-m-view="standings">Standings</button>
          <button class="m-action" type="button" data-m-view="race">Race</button>
          <button class="m-action" type="button" data-m-view="stats">Stats</button>
          <button class="m-action" type="button" id="m-open-schedule">Schedule</button>
        </div>
      </section>

      <section id="m-view-standings" class="m-view" data-view="standings">
        <header class="m-subheader">
          <h2>Standings</h2>
          <div class="m-seg" role="tablist" aria-label="Standings type">
            <button type="button" class="m-seg__btn is-active" role="tab" aria-selected="true" data-m-standings="drivers">Drivers</button>
            <button type="button" class="m-seg__btn" role="tab" aria-selected="false" data-m-standings="teams">Teams</button>
          </div>
        </header>
        <div id="m-standings-list" class="m-list"></div>
      </section>

      <section id="m-view-race" class="m-view" data-view="race">
        <header class="m-subheader">
          <h2>Race</h2>
          <label class="m-inline-select">
            <span class="sr-only">Race</span>
            <select id="m-race-select" aria-label="Select race"></select>
          </label>
        </header>
        <article id="m-race-card" class="m-card"></article>
        <div id="m-race-results" class="m-list"></div>
      </section>

      <section id="m-view-stats" class="m-view" data-view="stats">
        <header class="m-subheader">
          <h2>Stats</h2>
        </header>
        <div id="m-stats-grid" class="m-stats"></div>

        <!-- Mobile Analytics Section -->
        <div id="m-analytics" class="m-analytics">
          <header class="m-subheader">
            <h2>Analytics</h2>
          </header>

          <!-- Timeline Control -->
          <div class="m-analytics__card">
            <div class="m-analytics__header">
              <h3>Race Timeline</h3>
              <span class="m-analytics__value" id="m-timeline-value">All Races</span>
            </div>
            <div class="m-analytics__timeline">
              <input type="range" id="m-timeline-slider" class="m-timeline-slider" min="0" max="9" value="9" step="1" aria-label="Race timeline slider">
            </div>
          </div>

          <!-- Points Progression -->
          <div class="m-analytics__card" data-chart="points">
            <div class="m-analytics__header">
              <h3>Points Progression</h3>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-points-chart"></canvas>
            </div>
          </div>

          <!-- Points Gap -->
          <div class="m-analytics__card" data-chart="points-gap">
            <div class="m-analytics__header">
              <h3>Points Gap</h3>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-points-gap-chart"></canvas>
            </div>
          </div>

          <!-- Position Tracker -->
          <div class="m-analytics__card" data-chart="position">
            <div class="m-analytics__header">
              <h3>Position Tracker</h3>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-position-chart"></canvas>
            </div>
          </div>

          <!-- Heatmap -->
          <div class="m-analytics__card" data-chart="heatmap">
            <div class="m-analytics__header">
              <h3>Position Heatmap</h3>
            </div>
            <div class="m-analytics__heatmap" id="m-heatmap-container"></div>
          </div>

          <!-- Podium Distribution -->
          <div class="m-analytics__card" data-chart="podium">
            <div class="m-analytics__header">
              <h3>Podium Distribution</h3>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-podium-chart"></canvas>
            </div>
          </div>

          <!-- Form Guide -->
          <div class="m-analytics__card" data-chart="trend">
            <div class="m-analytics__header">
              <h3>Form Guide</h3>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-trend-chart"></canvas>
            </div>
          </div>

          <!-- Fastest Lap -->
          <div class="m-analytics__card" data-chart="fastest-lap">
            <div class="m-analytics__header">
              <h3>Fastest Lap</h3>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-fastest-lap-chart"></canvas>
            </div>
            <div class="m-analytics__stats" id="m-fastest-lap-stats"></div>
          </div>

          <!-- Head to Head -->
          <div class="m-analytics__card" data-chart="h2h">
            <div class="m-analytics__header">
              <h3>Head-to-Head</h3>
            </div>
            <div class="m-analytics__controls">
              <select id="m-h2h-driver1" class="m-select" aria-label="Driver 1"></select>
              <span class="m-analytics__vs">vs</span>
              <select id="m-h2h-driver2" class="m-select" aria-label="Driver 2"></select>
            </div>
            <div class="m-analytics__chart">
              <canvas id="m-h2h-chart"></canvas>
            </div>
            <div class="m-analytics__stats" id="m-h2h-summary"></div>
          </div>
        </div>
      </section>

      <section id="m-view-seasons" class="m-view" data-view="seasons">
        <header class="m-subheader">
          <h2>Seasons</h2>
        </header>
        <div id="m-season-list" class="m-season-list"></div>
      </section>
    </main>

    <nav class="m-bottom-nav" aria-label="Primary">
      <button class="m-nav-btn is-active" type="button" data-m-view="home" aria-label="Home">Home</button>
      <button class="m-nav-btn" type="button" data-m-view="standings" aria-label="Standings">Standings</button>
      <button class="m-nav-btn" type="button" data-m-view="race" aria-label="Race">Race</button>
      <button class="m-nav-btn" type="button" data-m-view="stats" aria-label="Stats">Stats</button>
      <button class="m-nav-btn" type="button" data-m-view="seasons" aria-label="Seasons">Seasons</button>
    </nav>
  </div>

  <header class="site-header">
    <div class="container nav-container">
      <a class="brand" href="#top" data-scroll>CETLA</a>
      <button class="nav-toggle" aria-expanded="false" aria-controls="primary-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="nav-toggle__line"></span>
        <span class="nav-toggle__line"></span>
        <span class="nav-toggle__line"></span>
      </button>
      <nav id="primary-nav" class="site-nav">
        <a href="#season-picker" data-scroll>Seasons</a>
        <a href="#standings" data-scroll>Standings</a>
        <a href="#races" data-scroll>Race Hub</a>
        <a href="#stats" data-scroll>Stats</a>
        <a href="analytics.html">Analytics</a>
      </nav>
    </div>
  </header>

  <main id="top">
    <section class="hero">
      <div class="container hero__content">
        <div class="hero__copy">
          <p class="eyebrow">CETLA Racing League</p>
          <h1 class="hero__title">All of our seasons. One living record.</h1>
          <p class="hero__subtitle">
            Browse every race we’ve run, follow the team battles, and keep the points table current in minutes.
          </p>
          <div class="hero__actions">
            <button id="cta-season" class="btn btn--primary">Jump to current season</button>
            <button id="open-fall-schedule" class="btn btn--ghost">Fall 2025 Schedule</button>
            <a class="btn btn--ghost" href="#races" data-scroll>Latest race results</a>
          </div>
        </div>
        <div class="hero__panel">
          <article class="hero-card hero-card--season">
            <header class="hero-card__header">
              <p class="eyebrow">Latest Season</p>
            </header>
            <h2 class="hero-card__title" id="hero-season-title">Season Snapshot</h2>
            <dl class="hero-metrics">
              <div>
                <dt>Season</dt>
                <dd id="hero-season-label">—</dd>
              </div>
              <div>
                <dt>Rounds</dt>
                <dd id="hero-season-rounds">—</dd>
              </div>
              <div>
                <dt>Top Driver</dt>
                <dd id="hero-season-leader">—</dd>
              </div>
              <div>
                <dt>Leading Team</dt>
                <dd id="hero-team-leader">—</dd>
              </div>
            </dl>
          </article>
          <article class="hero-card hero-card--race">
            <p class="eyebrow">Latest Race</p>
            <h2 class="hero-card__title" id="hero-race-title">Race Overview</h2>
            <p class="hero-race-meta" id="hero-race-meta">—</p>
            <div class="hero-podium" id="hero-podium">
              <p>Results will appear once a race is recorded.</p>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section id="season-picker" class="section section--pad">
      <div class="container">
        <header class="section__header">
          <h2>Pick a Season</h2>
          <p class="section__subtitle">Select a season to update points, add races, or view the standings.</p>
        </header>

        <div class="season-controls">
          <label class="season-select">
            <span class="season-select__label">Season</span>
            <select id="season-select" aria-label="Select season"></select>
          </label>
          <div class="season-pills" id="season-pills" role="listbox" aria-label="Season quick select"></div>
        </div>

        <article class="season-card" id="season-card">
          <header class="season-card__header">
            <div>
              <p class="eyebrow" id="season-card-year">—</p>
              <h3 id="season-card-title">Choose a season</h3>
            </div>
            <span class="season-card__badge" id="season-card-rounds">—</span>
          </header>
          <p class="season-card__description" id="season-card-description">
            The full description for the season will show up here once you select it.
          </p>
        </article>
      </div>
    </section>

    <section id="standings" class="section section--alt">
      <div class="container">
        <header class="section__header">
          <h2>Standings</h2>
          <p class="section__subtitle">Driver and team tables auto-sync from the shared season data file.</p>
        </header>

        <div class="tabs" role="tablist">
          <button class="tabs__button is-active" role="tab" aria-selected="true" data-tab="drivers">Drivers</button>
          <button class="tabs__button" role="tab" aria-selected="false" data-tab="teams">Teams</button>
        </div>

        <div class="tab-panels">
          <div class="tab-panel is-active" role="tabpanel" id="tab-drivers">
            <div class="table-wrapper">
              <table class="data-table" aria-label="Driver standings">
                <thead>
                  <tr>
                    <th scope="col" class="column--delta">Change</th>
                    <th scope="col">Driver</th>
                    <th scope="col">Team</th>
                    <th scope="col" class="column--points">Points</th>
                  </tr>
                </thead>
                <tbody id="driver-table-body"></tbody>
              </table>
            </div>
          </div>
          <div class="tab-panel" role="tabpanel" id="tab-teams">
            <div class="table-wrapper">
              <table class="data-table" aria-label="Team standings">
                <thead>
                  <tr>
                    <th scope="col" class="column--delta">Change</th>
                    <th scope="col">Team</th>
                    <th scope="col">Drivers</th>
                    <th scope="col" class="column--points">Points</th>
                  </tr>
                </thead>
                <tbody id="team-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="races" class="section section--pad">
      <div class="container">
        <header class="section__header section__header--row">
          <div>
            <h2>Race Center</h2>
            <p class="section__subtitle">Switch races to review settings, podiums, and individual lap awards.</p>
          </div>
          <label class="race-select">
            <span class="race-select__label">Race</span>
            <select id="race-select" aria-label="Select race"></select>
          </label>
        </header>

        <div class="race-layout">
          <article class="race-details" id="race-details-card">
            <header class="race-details__header">
              <div>
                <p class="eyebrow" id="race-round-label">Round —</p>
                <h3 id="race-title">Select a race</h3>
              </div>
              <time id="race-date" class="race-date">—</time>
            </header>
            <p class="race-venue" id="race-venue">Venue —</p>
            <dl class="race-settings" id="race-settings">
              <div>
                <dt>Car Class</dt>
                <dd id="race-car">—</dd>
              </div>
              <div>
                <dt>Weather</dt>
                <dd id="race-weather">—</dd>
              </div>
              <div>
                <dt>Laps</dt>
                <dd id="race-laps">—</dd>
              </div>
              <div>
                <dt>Notes</dt>
                <dd id="race-notes">—</dd>
              </div>
            </dl>
          </article>

          <figure class="race-track" id="race-track">
            <img id="race-track-image" src="" alt="Track preview" loading="lazy">
          </figure>
        </div>

        <div class="table-wrapper">
          <table class="data-table data-table--dense" aria-label="Race results">
            <thead>
              <tr>
                <th scope="col">Pos</th>
                <th scope="col">Driver</th>
                <th scope="col">Points</th>
                <th scope="col" class="column--hide-sm">Car</th>
                <th scope="col" class="column--hide-sm">Fastest Lap</th>
              </tr>
            </thead>
            <tbody id="race-results-body"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="stats" class="section section--alt">
      <div class="container">
        <header class="section__header">
          <h2>Season Insights</h2>
          <p class="section__subtitle">Quick-look stats update as soon as you update the shared data file.</p>
        </header>
        <div class="stats-grid">
          <article class="stat-card stat-card--clickable" data-stat="wins">
            <h3>Most Wins</h3>
            <div class="stat-list" id="stats-wins"></div>
          </article>
          <article class="stat-card stat-card--clickable" data-stat="podiums">
            <h3>Most Podiums</h3>
            <div class="stat-list" id="stats-podiums"></div>
          </article>
          <article class="stat-card stat-card--clickable" data-stat="avgPoints">
            <h3>Average Points</h3>
            <div class="stat-list" id="stats-average-points"></div>
          </article>
          <article class="stat-card stat-card--clickable" data-stat="avgPlacement">
            <h3>Average Finish</h3>
            <div class="stat-list stat-list--multi" id="stats-average-placement"></div>
          </article>
        </div>

        <div class="section__spacer" style="height: 1.75rem;"></div>

        <header class="section__header">
          <h2>Season Analytics</h2>
          <p class="section__subtitle">The full Analytics dashboard, embedded right here.</p>
        </header>

        <div id="embed-analytics" class="analytics-embed">
          <!-- Timeline Slider -->
          <div class="chart-card timeline-section">
            <header class="chart-card__header">
              <div>
                <h3>Race Timeline</h3>
                <p class="chart-subtitle">Drag the slider to see how the championship evolved race-by-race.</p>
              </div>
              <div class="timeline-display">
                <span class="timeline-label">Through Race:</span>
                <span class="timeline-value" id="embed-timeline-value">All Races</span>
              </div>
            </header>

            <div class="timeline-control">
              <button id="embed-timeline-play" class="timeline-btn" aria-label="Play timeline">
                <span class="play-icon">▶</span>
                <span class="pause-icon" style="display:none;">⏸</span>
              </button>
              <div class="timeline-slider-wrapper">
                <input
                  type="range"
                  id="embed-timeline-slider"
                  class="timeline-slider"
                  min="0"
                  max="1"
                  value="1"
                  step="1"
                  aria-label="Race timeline slider"
                >
                <div class="timeline-ticks" id="embed-timeline-ticks"></div>
              </div>
              <button id="embed-timeline-reset" class="timeline-btn timeline-btn--secondary" aria-label="Reset timeline">
                Reset
              </button>
            </div>
          </div>

          <!-- Points Progression Chart -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Points Progression</h3>
                <p class="chart-subtitle">Championship points accumulated over the season</p>
              </div>
              <div class="chart-controls">
                <label class="chart-toggle">
                  <input type="checkbox" id="embed-toggle-drivers" checked>
                  <span>Drivers</span>
                </label>
                <label class="chart-toggle">
                  <input type="checkbox" id="embed-toggle-teams">
                  <span>Teams</span>
                </label>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-points-chart"></canvas>
            </div>
          </div>

          <!-- Points Gap to Leader -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Points Gap to Leader</h3>
                <p class="chart-subtitle">How far each contender trails the championship leader after every race</p>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-points-gap-chart"></canvas>
            </div>
          </div>

          <!-- Position Change Tracker -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Championship Position Tracker</h3>
                <p class="chart-subtitle">Driver ranking after each race (lower lines mean higher positions)</p>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-position-change-chart"></canvas>
            </div>
          </div>

          <!-- Position Heatmap -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Position Heatmap</h3>
                <p class="chart-subtitle">Finishing positions across all races (darker = better finish)</p>
              </div>
              <div class="chart-controls">
                <label class="chart-select">
                  <span>Sort by:</span>
                  <select id="embed-heatmap-sort">
                    <option value="points">Total Points</option>
                    <option value="avg">Avg Position</option>
                    <option value="name">Driver Name</option>
                  </select>
                </label>
              </div>
            </header>
            <div class="heatmap-container" id="embed-heatmap-container"></div>
          </div>

          <!-- Podium Distribution -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Podium Distribution</h3>
                <p class="chart-subtitle">Breakdown of finishing positions for top drivers</p>
              </div>
              <div class="chart-controls">
                <label class="chart-select">
                  <span>Show:</span>
                  <select id="embed-podium-filter">
                    <option value="10">Top 10 Drivers</option>
                    <option value="5">Top 5 Drivers</option>
                    <option value="all">All Drivers</option>
                  </select>
                </label>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-podium-chart"></canvas>
            </div>
          </div>

          <!-- Average Position Trend -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Form Guide (3-Race Rolling Average)</h3>
                <p class="chart-subtitle">Track who's heating up or cooling down</p>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-trend-chart"></canvas>
            </div>
          </div>

          <!-- Fastest Lap Analysis -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Fastest Lap Analysis</h3>
                <p class="chart-subtitle">Average ranking position based on fastest lap times across all races</p>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-fastest-lap-chart"></canvas>
            </div>
            <div class="fastest-lap-stats" id="embed-fastest-lap-stats"></div>
          </div>

          <!-- Head to Head -->
          <div class="chart-card" style="margin-top: 1.25rem;">
            <header class="chart-card__header">
              <div>
                <h3>Head-to-Head Battle</h3>
                <p class="chart-subtitle">Compare two drivers race-by-race</p>
              </div>
              <div class="chart-controls chart-controls--h2h">
                <label class="chart-select">
                  <span>Driver 1:</span>
                  <select id="embed-h2h-driver1"></select>
                </label>
                <span class="h2h-vs">vs</span>
                <label class="chart-select">
                  <span>Driver 2:</span>
                  <select id="embed-h2h-driver2"></select>
                </label>
              </div>
            </header>
            <div class="chart-container">
              <canvas id="embed-h2h-chart"></canvas>
            </div>
            <div class="h2h-summary" id="embed-h2h-summary"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer__content">
      <p>Data-driven by <code>data/seasons.json</code>. Update the file, redeploy, done.</p>
      <small>&copy; <span id="footer-year"></span> CETLA Racing League</small>
    </div>
  </footer>

  <!-- Schedule Modal -->
  <div id="schedule-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-schedule-close></div>
    <div class="modal__panel" role="document">
      <header class="modal__header">
        <h3 class="modal__title">OG Series · Fall 2025 Schedule</h3>
        <button class="modal__close" aria-label="Close schedule" data-schedule-close>&times;</button>
      </header>
      <div class="modal__content">
        <section class="schedule-rules">
          <h4 class="schedule-rules__title">Race Rules</h4>
          <ul id="schedule-rules" class="schedule-rules__list"></ul>
        </section>
        <ul id="schedule-list" class="schedule-list"></ul>
      </div>
    </div>
  </div>

  <!-- Stats Modal -->
  <div id="stats-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-modal-close></div>
    <div class="modal__panel" role="document">
      <header class="modal__header">
        <h3 class="modal__title" id="modal-title">Stats</h3>
        <button class="modal__close" aria-label="Close" data-modal-close>&times;</button>
      </header>
      <div class="modal__content">
        <div id="modal-list"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
  <script src="assets/app.js?v=2025-12-18-17" type="module"></script>
</body>
</html>
